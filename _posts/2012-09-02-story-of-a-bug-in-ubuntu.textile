--- 
layout: post
title: "Story of a bug in Ubuntu"
tags: [ubuntu, debian, x2go, nx, bugs]
author_name: Emanuele Rocca
author_uri: http://twitter.com/emarocca
---

Some months ago I have run into a pretty interesting bug while working on a Ubuntu-based remote desktop system. The whole OS was installed on a server somewhere and users could access their desktop remotely. Some call this stuff _Desktop-as-a-Service_. 

The operating system we chose was Ubuntu Oneiric (11.10) and the remote access part was implemented with "x2go":http://www.x2go.org, which uses nxagent to provide NX transport of X sessions. Users could access their Ubuntu machines remotely, with sound, video, youtube, and all you would expect from a desktop machine. The whole thing was working quite well.

Now, as I said that was in May. Ubuntu 12.04 LTS was available, and the choice of upgrading to it sounded pretty much obvious. So we upgraded our test system to Precise and everything seemed to work smoothly. Till we tried to open a PDF document, actually. It took *evince* about 50 seconds to display a relatively small document. Same story with images opened with the default image viewer, *eog*. The fix delivered to our users was simple: we have set *shotwell-viewer* as the default image viewer, and *epdfview* as the default PDF viewer. Everybody happy.

In the meantime, obviously, I was interested in this issue so I've tried to run run evince from a terminal, getting the following output:

<pre>
(evince:15833): GRIP-WARNING **: Failed to initialize gesture manager.
</pre>

Funny. On another test system running Debian Sid (unstable) everything was working smoothly.

The diff between Ubuntu's version of evince and Debian's is a 6MB monster. Among other changes, I noticed that Ubuntu's version build-depends on libgrip-dev, which depends on libutouch-geis. Multitouch stuff.  Why should multitouch support break my remote session? So on May the 10th I "filed a bug on launchpad":https://bugs.launchpad.net/ubuntu/precise/+source/geis/+bug/997630.

How this issue got handled is in my opinion one of the many fine examples of the inherent superiority of free software, coupled with a "we won't hide problems" mindset. For an example of how bad is the proprietary approach, just check a random bug in "Adobe's bug tracking system":https://bugbase.adobe.com/index.cfm?event=bug&id=2968177. 

But let's go back to the evince bug.

Other users reported that their "VNC sessions were also affected":https://bugs.launchpad.net/ubuntu/precise/+source/geis/+bug/997630/comments/3 by the same problem. After a few days it was clear that the culprit was utouch-geis, and a patch appeared. Unfortunately "it did not actually address the issue":https://bugs.launchpad.net/ubuntu/precise/+source/geis/+bug/997630/comments/13. Somebody else reported that "RDP sessions were broken too":https://bugs.launchpad.net/ubuntu/precise/+source/geis/+bug/997630/comments/16. At the beginning of June "Precise was still affected":https://bugs.launchpad.net/ubuntu/precise/+source/geis/+bug/997630/comments/14. Finally, on August the 6th "a working patch was submitted":https://bugs.launchpad.net/ubuntu/precise/+source/geis/+bug/997630/comments/19 by Bradley M. Froehle and included by Chase Douglas (thank you guys). End of August, fixed version of geis "accepted into precise-updates":https://bugs.launchpad.net/ubuntu/precise/+source/geis/+bug/997630/comments/28, case closed.

Now for some considerations. The problem was clearly of a certain importance. A Long Term Support, stable version of Ubuntu shipped with broken PDF and image viewing functionalities. It got fixed properly, even though 3 good months are quite a long time for such a bug to get solved. However, the issue only affected a pretty limited number of users, also certainly not Ubuntu's main target audience.

This bug never affected Debian, simply because "utouch-geis has not made its way into the archive yet":http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=663882. It takes longer to make changes like this in Debian, but for some categories of users stability is more important than new, cool features. Choice is a good thing.
